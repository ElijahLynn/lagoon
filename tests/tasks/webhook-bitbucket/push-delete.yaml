- name: "{{ testname }} - POST bitbucket push delete webhook with branch {{ branch }} and repo {{ git_repo_ssh_url }} to {{ lookup('env','WEBHOOK_PROTOCOL') }}://{{ lookup('env','WEBHOOK_HOST') }}:{{ lookup('env','WEBHOOK_PORT') }}"
  uri:
    url: "{{ lookup('env','WEBHOOK_PROTOCOL') }}://{{ lookup('env','WEBHOOK_HOST') }}:{{ lookup('env','WEBHOOK_PORT') }}"
    headers:
      User-Agent: Bitbucket-Webhooks/2.0
      X-Event-Key: repo:push
      X-Hook-Uuid: bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb
      X-Request-Uuid: cccccccc-cccc-cccc-cccccccccccc
      content-type: application/json
    method: POST
    follow_redirects: yes
    body_format: json
    body: '{"push":{"changes":[{"forced":false,"old":{"type":"branch","name":"{{ branch }}","links":{"commits":{"href":"https://api.bitbucket.org/2.0/repositories/twardnw/amazeeio-site/commits/testdelete"},"self":{"href":"https://api.bitbucket.org/2.0/repositories/twardnw/amazeeio-site/refs/branches/testdelete"},"html":{"href":"https://bitbucket.org/twardnw/amazeeio-site/branch/testdelete"}},"target":{"hash":"5832e7751e50bd719343033a124eaa2f5c4e8757","links":{"self":{"href":"https://api.bitbucket.org/2.0/repositories/twardnw/amazeeio-site/commit/5832e7751e50bd719343033a124eaa2f5c4e8757"},"html":{"href":"https://bitbucket.org/twardnw/amazeeio-site/commits/5832e7751e50bd719343033a124eaa2f5c4e8757"}},"author":{"raw":"Tyler Ward <twardnw@gmail.com>","type":"author","user":{"username":"twardnw","type":"user","display_name":"Tyler Ward","uuid":"{30b80339-43dd-4f3a-93cd-a2cfc8ecaaa4}","links":{"self":{"href":"https://api.bitbucket.org/2.0/users/twardnw"},"html":{"href":"https://bitbucket.org/twardnw/"},"avatar":{"href":"https://bitbucket.org/account/twardnw/avatar/32/"}}}},"parents":[{"type":"commit","hash":"7e4814137ae5a624f4284f1b85577b6f50f21003","links":{"self":{"href":"https://api.bitbucket.org/2.0/repositories/twardnw/amazeeio-site/commit/7e4814137ae5a624f4284f1b85577b6f50f21003"},"html":{"href":"https://bitbucket.org/twardnw/amazeeio-site/commits/7e4814137ae5a624f4284f1b85577b6f50f21003"}}}],"date":"2017-07-13T18:33:04+00:00","message":"bitbucket regular push\n","type":"commit"}},"truncated":false,"created":false,"closed":true,"new":null}]},"actor":{"username":"twardnw","type":"user","display_name":"Tyler Ward","uuid":"{30b80339-43dd-4f3a-93cd-a2cfc8ecaaa4}","links":{"self":{"href":"https://api.bitbucket.org/2.0/users/twardnw"},"html":{"href":"https://bitbucket.org/twardnw/"},"avatar":{"href":"https://bitbucket.org/account/twardnw/avatar/32/"}}},"repository":{"scm":"git","website":"","name":"amazeeio-site","links":{"self":{"href":"https://api.bitbucket.org/2.0/repositories/twardnw/amazeeio-site"},"html":{"href":"https://bitbucket.org/twardnw/amazeeio-site"},"avatar":{"href":"https://bitbucket.org/twardnw/amazeeio-site/avatar/32/"}},"full_name":"twardnw/amazeeio-site","owner":{"username":"twardnw","type":"user","display_name":"Tyler Ward","uuid":"{30b80339-43dd-4f3a-93cd-a2cfc8ecaaa4}","links":{"self":{"href":"https://api.bitbucket.org/2.0/users/twardnw"},"html":{"href":"https://bitbucket.org/twardnw/"},"avatar":{"href":"https://bitbucket.org/account/twardnw/avatar/32/"}}},"type":"repository","is_private":true,"uuid":"{34d2ec16-e8eb-4223-a449-cdd6447db7ea}"}}'
